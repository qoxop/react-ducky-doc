"use strict";(self.webpackChunkreact_ducky_doc=self.webpackChunkreact_ducky_doc||[]).push([[648],{3905:function(e,t,n){n.d(t,{Zo:function(){return d},kt:function(){return m}});var r=n(7294);function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function o(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?o(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):o(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function i(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var l=r.createContext({}),s=function(e){var t=r.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},d=function(e){var t=s(e.components);return r.createElement(l.Provider,{value:t},e.children)},u={inlineCode:"code",wrapper:function(e){var t=e.children;return r.createElement(r.Fragment,{},t)}},p=r.forwardRef((function(e,t){var n=e.components,a=e.mdxType,o=e.originalType,l=e.parentName,d=i(e,["components","mdxType","originalType","parentName"]),p=s(n),m=a,f=p["".concat(l,".").concat(m)]||p[m]||u[m]||o;return n?r.createElement(f,c(c({ref:t},d),{},{components:n})):r.createElement(f,c({ref:t},d))}));function m(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var o=n.length,c=new Array(o);c[0]=p;var i={};for(var l in t)hasOwnProperty.call(t,l)&&(i[l]=t[l]);i.originalType=e,i.mdxType="string"==typeof e?e:a,c[1]=i;for(var s=2;s<o;s++)c[s]=n[s];return r.createElement.apply(null,c)}return r.createElement.apply(null,n)}p.displayName="MDXCreateElement"},2073:function(e,t,n){n.r(t),n.d(t,{frontMatter:function(){return i},contentTitle:function(){return l},metadata:function(){return s},toc:function(){return d},default:function(){return p}});var r=n(7462),a=n(3366),o=(n(7294),n(3905)),c=["components"],i={sidebar_position:1,sidebar_label:"createModel"},l="createModel",s={unversionedId:"API-Reference/reducer-and-actions/createModel",id:"API-Reference/reducer-and-actions/createModel",isDocsHomePage:!1,title:"createModel",description:"createModel \u51fd\u6570\u63a5\u53d7\u521d\u59cb\u72b6\u6001\u3001reducer\u51fd\u6570\u5bf9\u8c61\u3001\u5f02\u6b65\u6570\u636e\u51fd\u6570\u5bf9\u8c61\u548c Model \u540d\u79f0\uff0c\u5e76\u81ea\u52a8\u751f\u6210\u4e0e reducer \u548c\u72b6\u6001\u5bf9\u5e94\u7684 actionCreators \u548c action-type\u3002",source:"@site/docs/API-Reference/reducer-and-actions/createModel.md",sourceDirName:"API-Reference/reducer-and-actions",slug:"/API-Reference/reducer-and-actions/createModel",permalink:"/react-ducky-doc/docs/API-Reference/reducer-and-actions/createModel",editUrl:"https://github.com/qoxop/react-ducky-doc/tree/main/docs/API-Reference/reducer-and-actions/createModel.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1,sidebar_label:"createModel"},sidebar:"tutorialSidebar",previous:{title:"useActions",permalink:"/react-ducky-doc/docs/API-Reference/hooks/useActions"},next:{title:"createAction",permalink:"/react-ducky-doc/docs/API-Reference/reducer-and-actions/createAction"}},d=[{value:"\u53c2\u6570\u8bf4\u660e",id:"\u53c2\u6570\u8bf4\u660e",children:[{value:"<code>reducers</code>",id:"reducers",children:[{value:"\u81ea\u5b9a\u4e49 ActionCreator",id:"\u81ea\u5b9a\u4e49-actioncreator",children:[],level:4}],level:3},{value:"<code>atomFetchers</code>",id:"atomfetchers",children:[],level:3},{value:"<code>extraReducers</code>",id:"extrareducers",children:[],level:3},{value:"<code>persistence</code>",id:"persistence",children:[],level:3},{value:"<code>persistenceKey</code>",id:"persistencekey",children:[],level:3}],level:2},{value:"\u8fd4\u56de\u503c\u8bf4\u660e",id:"\u8fd4\u56de\u503c\u8bf4\u660e",children:[],level:2}],u={toc:d};function p(e){var t=e.components,n=(0,a.Z)(e,c);return(0,o.kt)("wrapper",(0,r.Z)({},u,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"createmodel"},"createModel"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"createModel")," \u51fd\u6570\u63a5\u53d7\u521d\u59cb\u72b6\u6001\u3001reducer\u51fd\u6570\u5bf9\u8c61\u3001\u5f02\u6b65\u6570\u636e\u51fd\u6570\u5bf9\u8c61\u548c Model \u540d\u79f0\uff0c\u5e76\u81ea\u52a8\u751f\u6210\u4e0e ",(0,o.kt)("inlineCode",{parentName:"p"},"reducer")," \u548c\u72b6\u6001\u5bf9\u5e94\u7684 ",(0,o.kt)("inlineCode",{parentName:"p"},"actionCreators")," \u548c ",(0,o.kt)("inlineCode",{parentName:"p"},"action-type"),"\u3002"),(0,o.kt)("p",null,"\u8fd9\u4e2aAPI\u53c2\u7167\u4e86 ",(0,o.kt)("inlineCode",{parentName:"p"},"redux-toolki")," \u7684 ",(0,o.kt)("inlineCode",{parentName:"p"},"createSlice")," \u65b9\u6cd5\uff0c\u5e76\u5bf9\u5176\u8fdb\u884c\u4e86\u6269\u5c55\uff0c\u4f7f\u5176\u652f\u6301\u6570\u636e\u6301\u4e45\u5316\u7f13\u5b58\u914d\u7f6e\uff0c\u5f02\u6b65\u5143\u6570\u636e\u83b7\u53d6\u81ea\u52a8\u751f\u6210\u5f02\u6b65Actions\u7b49\u65b0\u7279\u6027\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts",metastring:"title=UserScoreModel",title:"UserScoreModel"},"import { createModel, PayloadAction, AtomObject } from 'react-ducky';\n\ntype UserScoreState = {\n    userInfo: AtomObject<{name: string}>;\n    score: number;\n}\nconst state:UserScoreState = {\n    userInfo: null,\n    score: 0,\n}\n\nconst model = createModel({\n    name: 'user-score',\n    initialState: state,\n    reducers: {\n        addScore(state, action: PayloadAction<number>) {\n            state.score += action.payload;\n        },\n        decreaseScore(state, action: PayloadAction<number>) {\n            state.score -= action.payload;\n        }\n    },\n    atomFetchers: {\n        userInfo() {\n            return Promise.resolve({name: 'javascript'})\n        }\n    },\n    // \u5c06\u6570\u636e\u6301\u4e45\u5316\u5230 sessionStorage\uff0c\u907f\u514d\u5237\u65b0\u9875\u9762\u65f6\u72b6\u6001\u4e22\u5931\n    persistence: 'session'\n});\n// \u540c\u6b65 Action\nexport const { addScore, decreaseScore} = model.actions;\n// \u5f02\u6b65 Action\nexport const { userInfo: getUserInfo } = model.atomActions;\n// \u6570\u636e\u67e5\u8be2\nexport const { getState, useModel, name: modelName } = model;\n// \u6570\u636e\u5904\u7406\nexport default model.reducer;\n")),(0,o.kt)("h2",{id:"\u53c2\u6570\u8bf4\u660e"},"\u53c2\u6570\u8bf4\u660e"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"createModel")," \u63a5\u53d7\u5355\u4e2a\u914d\u7f6e\u5bf9\u8c61\u53c2\u6570\uff0c\u5177\u6709\u4ee5\u4e0b\u9009\u9879:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts",metastring:"title=TYPE",title:"TYPE"},"type CreateModelOption = {\n    // model \u540d\u79f0\uff0c\u7528\u4e8e\u751f\u6210 action type\n    name: string;\n    // reducer \u7684\u521d\u59cb\u503c\n    initialState: any;\n    // \"case reducers\" \u7684\u5bf9\u8c61\u3002\u952e\u540d\u5c06\u7528\u4e8e\u751f\u6210\u52a8\u4f5c\u3002\n    reducers: Record<string, CaseReducer | CaseReducerWithPrepare>;\n    // \u5f02\u6b65\u6570\u636e\u83b7\u53d6\u65b9\u6cd5\u5bf9\u8c61\n    atomFetchers: Record<string, PromiseFn>;\n    // \u914d\u7f6e\u5982\u4f55\u4ece\u6839State \u83b7\u53d6\u5230\u5f53\u524d Model \u7684 state \u7684\u65b9\u6cd5\uff0c\u5efa\u8bae reducer \u7684\u6302\u8f7d\u952e\u540d\u4f7f\u7528 name (\u5219\u53ef\u4ee5\u4e0d\u7528\u63d0\u4f9b selector)\n    selector?: (appState: A) => any;\n    // \u76d1\u542c\u5176\u4ed6\u7684 Actions \n    extraReducers?: Record<string, CaseReducer> | ((builder: Builder) => void);\n    // \u6570\u636e\u6301\u4e45\u5316\u914d\u7f6e\n    persistence?: 'session'|'local';\n    persistenceKey?: string;\n}\n")),(0,o.kt)("h3",{id:"reducers"},(0,o.kt)("inlineCode",{parentName:"h3"},"reducers")),(0,o.kt)("p",null,"\u4e00\u4e2a\u5305\u542b Redux\u201ccase reducer\u201d\u51fd\u6570\u7684\u5bf9\u8c61\uff08\u7528\u4e8e\u5904\u7406\u7279\u5b9a\u52a8\u4f5c\u7c7b\u578b\u7684\u51fd\u6570\uff0c\u76f8\u5f53\u4e8e switch \u4e2d\u7684\u5355\u4e2a case \u8bed\u53e5\uff09\u3002\u8fd9\u4e2a\u5bf9\u8c61\u5c06\u88ab\u4f20\u9012\u7ed9 ",(0,o.kt)("inlineCode",{parentName:"p"},"createReducer"),"\uff0c\u56e0\u6b64 reducer \u53ef\u4ee5\u5b89\u5168\u5730\u201c\u6539\u53d8\u201d\u5b83\u4eec\u88ab\u8d4b\u4e88\u7684\u72b6\u6001\u3002"),(0,o.kt)("p",null,"\u5bf9\u8c61\u4e2d\u7684\u952e\u5c06\u88ab\u7528\u4e8e\u751f\u6210\u5b57\u7b26\u4e32\u7c7b\u578b\u7684 ",(0,o.kt)("inlineCode",{parentName:"p"},"action type")," \uff0c\u751f\u6210\u683c\u5f0f\u662f ",(0,o.kt)("inlineCode",{parentName:"p"},"[name]/[key]"),"\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},'import { createModel } from "react-ducky";\n\nconst countModel = createModel({\n    name: "counter",\n    initialState: { count: 0 },\n    reducers: {\n        increment: (state) => {\n            state.count + 1\n        },\n    }\n})\n// \u751f\u6210\u7684 action type = `counter/increment`\n')),(0,o.kt)("h4",{id:"\u81ea\u5b9a\u4e49-actioncreator"},"\u81ea\u5b9a\u4e49 ActionCreator"),(0,o.kt)("p",null,"\u5982\u679c\u4f60\u9700\u8981\u81ea\u5b9a\u4e49 ActionCreator \u65b9\u6cd5\u7684\u53c2\u6570\u7c7b\u578b\uff0c\u53ef\u4ee5\u4f7f\u7528 prepare \u56de\u8c03\u65b9\u6cd5\u8fdb\u884c\u81ea\u5b9a\u4e49\u914d\u7f6e\uff0c\u6700\u7ec8\u751f\u6210\u7684 ActionCreator \u4e0e prepare \u56de\u8c03\u65b9\u6cd5\u7684\u53c2\u6570\u8981\u6c42\u662f\u4e00\u6837\u7684\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-tsx"},"import { createModel, PayloadAction } from 'react-ducky'\n\ninterface Item {\n  id: string\n  text: string\n}\n\nconst todosModel = createModel({\n  name: 'todos',\n  initialState: [] as Item[],\n  reducers: {\n    addTodo: {\n      reducer: (state, action: PayloadAction<Item>) => {\n        state.push(action.payload)\n      },\n      prepare: (text: string) => {\n        const id = uuid();\n        return { payload: { id, text } }\n      },\n    },\n  },\n})\n\n// todosModel.actions.addTodo: (text: string) => PayloadAction<Item>\n")),(0,o.kt)("h3",{id:"atomfetchers"},(0,o.kt)("inlineCode",{parentName:"h3"},"atomFetchers")),(0,o.kt)("p",null,"\u5982\u679c\u4f60\u7684 initState \u7c7b\u578b\u4e2d\u5b58\u5728\u4e00\u4e9b\u5b57\u6bb5\u662f ",(0,o.kt)("inlineCode",{parentName:"p"},"AtomObject")," \u7c7b\u578b\u7684\uff0ccreateModel \u4f1a\u8981\u6c42\u4f60\u63d0\u4f9b\u5bf9\u5e94\u7684\u6570\u636e\u83b7\u53d6\u65b9\u6cd5\uff0c\u7136\u540e\u6839\u636e\u4f60\u63d0\u4f9b\u7684\u6570\u636e\u83b7\u53d6\u65b9\u6cd5\u81ea\u52a8\u751f\u6210\u5bf9\u5e94\u7684\u5f02\u6b65\u7684 ",(0,o.kt)("inlineCode",{parentName:"p"},"ActionsCreator")),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"import { createModel, PayloadAction, AtomObject } from 'react-ducky';\n\ntype UserState = {\n    userInfo: AtomObject<{ name: string, gender: 0|1|2 }>\n}\n\nconst userModel = createModel<UserState>({\n    name: 'user',\n    initialState: { userInfo: null },\n    atomFetchers: {\n        userInfo() {\n            return Promise.resolve({name: 'javascript', gender: 0 })\n        }\n    }\n})\n\n// userModel.atomActions.userInfo: () => (dispatch: Dispatch<AnyAction>) => Promise<{ name: string, gender: 0|1|2 }>\n")),(0,o.kt)("h3",{id:"extrareducers"},(0,o.kt)("inlineCode",{parentName:"h3"},"extraReducers")),(0,o.kt)("p",null,"\u7528\u4e8e\u54cd\u5e94\u5f53\u524d ",(0,o.kt)("inlineCode",{parentName:"p"},"Model")," \u751f\u6210\u7684 ",(0,o.kt)("inlineCode",{parentName:"p"},"actions")," \u4e4b\u5916\u7684\u5176\u4ed6 ",(0,o.kt)("inlineCode",{parentName:"p"},"actions"),"\u3002\u6bd4\u5982\uff0c\u4f60\u9700\u8981\u5728\u9000\u51fa\u767b\u5f55\u8fd9\u4e2a\u52a8\u4f5c\u89e6\u53d1\u65f6\u91cd\u7f6e\u5f53\u524d ",(0,o.kt)("inlineCode",{parentName:"p"},"Model")," \u7684\u6570\u636e\uff0c\u50cf\u8fd9\u79cd\u573a\u666f\u4f7f\u7528 ",(0,o.kt)("inlineCode",{parentName:"p"},"extraReducers")," \u5c31\u4f1a\u7279\u522b\u65b9\u4fbf\u3002"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"extraReducers")," \u652f\u6301\u952e\u503c\u5bf9\u5bf9\u8c61\u5199\u6cd5\u548c\u56de\u8c03\u5199\u6cd5\u3002"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts"},"import { createModel, PayloadAction, AtomObject } from 'react-ducky';\n\ntype UserState = {\n    userInfo: AtomObject<{ name: string, gender: 0|1|2 }>\n}\n\nconst userModel = createModel<UserState>({\n    name: 'user',\n    initialState: { userInfo: null },\n    atomFetchers: {\n        userInfo() {\n            return Promise.resolve({name: 'javascript', gender: 0 })\n        }\n    },\n    // \u5bf9\u8c61\u5199\u6cd5\n    // extraReducers: {\n    //     'logout': (state) => {\n    //         state.userInfo = null\n    //     }\n    // },\n    // \u56de\u8c03\u5199\u6cd5\n    extraReducers: (builder) => {\n        builder.addCase('logout', (state) => {\n            state.userInfo = null;\n        });\n    },\n})\n")),(0,o.kt)("h3",{id:"persistence"},(0,o.kt)("inlineCode",{parentName:"h3"},"persistence")),(0,o.kt)("p",null,"\u7528\u4e8e\u9009\u62e9\u4f7f\u7528\u4ec0\u4e48\u5b58\u50a8\u65b9\u5f0f\u8fdb\u884c\u6301\u4e45\u5316\u7f13\u5b58\uff0c\u76ee\u524d\u53ef\u9009\u7684\u5c31\u4fe9\u79cd \u2014\u2014 ",(0,o.kt)("inlineCode",{parentName:"p"},"'local'|'sesstion'"),", \u5206\u522b\u5bf9\u5e94 localStorage \u548c  sessionStorage"),(0,o.kt)("h3",{id:"persistencekey"},(0,o.kt)("inlineCode",{parentName:"h3"},"persistenceKey")),(0,o.kt)("p",null,"\u914d\u7f6e\u5b58\u50a8\u65f6\u6240\u7528\u7684\u952e\u503c\uff0c\u9ed8\u8ba4\u662f ",(0,o.kt)("inlineCode",{parentName:"p"},"REDUX-PERSISTENCE-[name]")),(0,o.kt)("h2",{id:"\u8fd4\u56de\u503c\u8bf4\u660e"},"\u8fd4\u56de\u503c\u8bf4\u660e"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"createModel")," \u8fd4\u56de\u4e00\u4e2a Model \u5bf9\u8c61\uff0c\u7ed3\u6784\u5982\u4e0b\uff1a"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-ts",metastring:"title=TYPES",title:"TYPES"},"/**\n * Model \u5bf9\u8c61\u6570\u636e\u7ed3\u6784\n */\nexport type Model<State> = {\n    name: string;\n    reducer: Reducer;\n    actions: ActionCreators;\n    getState: () => State;\n    useModel: (selector, config?: { isPending, isEqual }) => any;\n    atomFetchers?: AsyncActionCreators\n}\n")))}p.isMDXComponent=!0}}]);